.\" This file Copyright 1998-2000 Luca Deri <deri@ntop.org>
.\"
.
.de It
.TP 1.2
.B "\\$1 "
..
.TH NTOP 8 "August 2000"
.SH NAME
ntop \- display top network users
.SH SYNOPSIS
.B ntop
.RB [ -c ]
.RB [ -r
.IR "refresh time" ]
.RB [ -R
.IR "filter rules" ]
.RB [ -f
.IR "traffic dump file" ]
.RB [ -n ]
.RB [ -N ]
.RB [ -M ]
.RB [ -p ]
.IR "IP protocols to monitor" ]
.RB [ -i 
.IR interface ]
.RB [ -e 
.IR "num rows" ]
.RB [ -w 
.IR HTTP port ]
.RB [ -W
.IR HTTPS port ]
.RB [ -d ]
.RB [ -S value ]
.RB [ -P 
.IR dbpath]
.RB [ -m 
.IR "local subnet" ]
.RB [ -a
.IR "access log file path" ]
.RB [ -t
.IR "trace level" ]
.RB [ -u
.IR "user name" ]
.RB [ -l
.IR "dump file name" ]
.RB [ -F 
.IR "flow filter expression" ]
.RB [ "filter expression" ]
.SH DESCRIPTION
.B ntop
shows the current network usage. It displays a list of hosts that are
currently using the network and reports information concerning the (IP and non-IP) 
traffic generated by each host. 
.B ntop
can be started either in a terminal window (see
.B intop
) or in
web mode. In the latter case, a web browser is needed to use the
program. 

.PP
.SH "COMMAND\-LINE OPTIONS"

.It -c
By default idle hosts are periodically purged from memory. Use this flag to prevent idle hosts from being purged from memory. NOTE: if idle hosts are kept in memory you can experience severe memory usage.

.It -R
Specifies the filter rules used by ntop for emitting alerts and warnings when the traffic matches the specified rules. Shall you need further details about filter rules, please refer to ntop-rules (8) man page.

.It -r
Specifies the delay (in seconds) between screen updates (the default is 3 seconds). If the -l flag is used, it specifies how often entries are logged in the log file. Please
note that if the delay is very short (1 second for instance), ntop might not
be able to process all the network traffic.

.It -f
Specifies the file containing tcpdump captured traffic that has to be used by ntop. Note: if you specify -f ntop will not capture any traffic after the file has been read. This option is mostly used for debug purposes.

.It -N
Forces ntop not to use nmap (if it is installed).

.It -M
Forces ntop not to merge network interfaces together. This means that ntop will collect statistics for each interface and will not merge data together.

.It -n
This causes
.B ntop
to show numeric IP addresses instead of the symbolic names. This option can useful 
when the DNS is not present or quite slow.  You can toggle the address format 
(numeric vs. symbolic) by pressing the
.B n
key while 
.B ntop
is running.

.It -p
It is used to specify the IP protocols that
.B ntop
will monitor. The format is <label>=<protocol list> [, <label>=<protocol list>], where
label is used to symbolically identify the <protocol list>. The format of <protocol list>
is <protocol>[|<protocol>], where <protocol> is either a valid protocol specified inside the
/etc/services file or a numeric port range (e.g. 80, or 6000-6500). If the -p flag is omitted the following 
default value is used: "FTP=ftp|ftp-data,HTTP=http|www|https,DNS=name|domain,Telnet=telnet|login,NBios-IP=netbios-ns|netbios-dgm|netbios-ssn,Mail=pop-2|pop-3|kpop|smtp|imap|imap2,SNMP=snmp|snmp-trap,NEWS=nntp,NFS=mount|pcnfs|bwnfs|nfs|nfsd-status,X11=6000-6010,SSH=ssh". If the <protocol list> is very long you may store in a file (for instance protocol.list) the value of the <protocol list> and specify the file name instead of the <protocol list> (in above example you will invoke 'ntop -p protocol.list').


.It -i
Specifies the network interface used by
.B ntop
If multiple interfaces are used (this feature is available only if ntop is compiled with thread support) they have to be separated with a comma. For instance -i "eth0,lo". Traffic information obtained by all the interfaces is merged together as if the traffic would have been produced by one interface. Use the -M flag for not merging traffic.
.

.It -e 
Is the maximum number of HTML table rows that
.B ntop
will display. 

.It -w 
.B ntop
sports and embedded web server so that users can attach their web browsers to the specified port and browse 
traffic information remotely. Supposing to start
.B ntop
at the port 
.B 3000 
(default port), the URL to access is
http://hostname:3000/. Users and URLs to protect with passwords are
stored in a database file. By default user/URL administration
are accessible uniquely by the user 
.B admin
with password
.B admin
. Users can modify/add/delete users/URLs using ntop itself. 
Passwords are stored in an encrypted form into the database for
further security. Please note that an HTTP server is NOT
needed but it's embedded into the application. If -w is set to 0 the HTTP port will not be enabled ('-w 0' is accepted only if 
.B ntop
 has been compiled with HTTPS support and 
.B ntop 
has not been started with '-W 0' [see below]).

.It -W 
If 
.B ntop
has been compiled with HTTPS support (via OpenSSL), this flag can be used to set the HTTPS port (default 
.B 3001
). If the user specifies '-W 0', HTTPS support is disabled. Some examples: 1. 
.B ntop -w 80 -W 443 
(both HTTP and HTTPS have been enabled at their default ports) 2. 
.B ntop -w 0 -W 443 
(HTTP disabled, HTTPS enabled at the default port).


.It -d
This flag causes ntop to become a daemon, i.e. it is started in background and detached from the terminal.

.It -S value
Use this flag for telling ntop to save information about host traffic on shutdown. Valid values are: 0 = don't store hosts, 1 = store all hosts, 2 = store only local hosts. This flag allows ntop not to loose traffic stats across multiple ntop sessions. Please note that information about TCP session is (obviously) lost.

.It -P
This allows to specify where db-files are searched or created (default "."). In addition DBPATH/html is added to the searchlist for the WEB-files

.It -m
This flag allows users to specify the subnets whose traffic is considered local. The format is <network address>/<# subnet mask bits>[,<network address>/<# subnet mask bits>]. For instance "131.114.21.0/24,10.0.0.0/255.0.0.0".

.It -a
By default 
.B ntop
logs HTTP accesses in the file ntop.access.log in the current directory. Use this flag to specify the path of the file where HTTP accesses will be logged. Each log entry is in Apache-like style. The only difference between Apache and 
.B ntop
is that .B ntop
added a new column has been added. Such column contains the time (in milliseconds) that ntop needed in order to serve the request. 

t -u
Specifies the user
.B ntop
should run as after it initializes. The value specified may be either a
username or a numeric user id. The group id used will be the primary group of
the user specified.

t -l
Dumps the network traffic captured by ntop in a file in pcap format (useful for debug).

.It -t
This flag specifies the level of
.B ntop
tracings on stdout. The trace level ranges between 0 (no trace) and 5 (full debug tracings). The default trace value is 3. The higher is the trace level the more information are printed. Trace level 1 is used to print errors only, level 2 for both warnings and errors, and so on. 

.It -F 
It is used to specify network flows similar to more powerful applications such as NeTraMet. A flow is a stream of captured packets that match a specified rule. The format is <flow-label>='<matching expression>'[,<flow-label>='<matching expression>'], where the label is used to symbolically identify the flow specified by the expression. The expression format is specified in the appendix. If an expression is specified, then the information concerning flows can be accessed following the HTML link named 'List NetFlows'.
For instance suppose to define two flows with the following expression "LucaHosts='host jake.unipi.it or host pisanino.unipi.it',GatewayRoutedPkts='gateway gateway.unipi.it'". All the traffic sent/received by hosts jake.unipi.it or pisanino.unipi.it is collected by
.B ntop
and added to the LucaHosts flow, whereas all the packet routed by the gateway gateway.unipi.it are added to the GatewayRoutedPkts flow. If the flows list is very long you may store in a file (for instance flows.list) the list of flows and specify the file name instead of the flows list (in above example you will invoke 'ntop -F flows.list').



.It "filter expression"
.B ntop
, similar to what tcpdump does, allows users to specify an expression
that restricts the type of traffic handled by
.B ntop
hence to select only the traffic of interest. For instance, suppose to
be interested only in the traffic generated/received by the host
jake.unipi.it. 
.B ntop
can then be started with the following filter: 'ntop src host jake.unipi.it 
or dst host jake.unipi.it'. See the
.B tcpdump
man page for further information about this topic.


.SH "WEB VIEWS"
While
.B ntop
is running, multiple users can access the traffic information using conventional web browsers. The main HTML page, is divided is two frames. The left frame allows users to select the traffic view that will be displayed in the right frame. Available sections are: sort traffic by data sent, sort traffic by data received, traffic statistics, active hosts list, remote to local (i.e. inside the subnet defined for the network board from which the program is currently sniffing) IP traffic, local to remote IP traffic, local to local IP traffic, list of active TCP sessions, IP protocol distribution statistics, IP protocol usage, IP traffic matrix.

.SH NOTES
.B ntop
is based on the libpcap library that can be found
at http://www.tcpdump.org/. The Win32 version makes use of
libpcap for Win32 that can be downloaded from http://www.netgroup.polito.it/WinPcap/install/).
.
.SH "SEE ALSO"
.BR intop (1),
.BR ntop-rules (8),
.BR top (1),
.BR ngrep (8),
.BR tcpdump (8).
.BR netramet (http://www.auckland.ac.nz/net/Accounting/ntm.Release.note.html).
.
.
.SH AUTHOR
Please send bug reports to the ntop mailing list <ntop@ntop.org>. ntop's author is Luca Deri <deri@ntop.org>.
