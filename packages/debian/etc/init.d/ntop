#! /bin/sh
set -e
#
# (C) 2003 - Luca Deri <deri@ntop.org>
# (C) 2007 - Massimo Torquati <torquati@ntop.org>
#

APPNAME=ntop

####################

start_ntop() {
   if test -f /etc/ntop/ntop.start; then
      start-stop-daemon --start --quiet --name $APPNAME --background --exec /usr/local/bin/ntop @/etc/ntop/ntop.conf > /dev/null
   fi
}

####################

stop_ntop() { 
    start-stop-daemon --stop --oknodo --name $APPNAME --retry 9
}

####################

default_ntop() { 
    chown -R nobody /usr/local/var/ntop/rrd
    if [ ! -f /usr/local/share/ntop/ntop_pw.db ]; then
	/usr/local/bin/ntop -P /usr/local/share/ntop -Q /var/log/ntop --set-admin-password=admin
    fi
}

########

case "$1" in
  start)
	echo -n "Starting ntop "
	default_ntop;
	start_ntop;
	echo " Done."
	;;
  stop)
        echo -n "Stopping ntop "
       	stop_ntop;
	echo " Done."
	;;

  default)
        echo -n "Defaulting ntop "
       	default_ntop;
	echo " Done."
	;;

  restart)
        echo -n "Restarting ntop "
	stop_ntop;
	start_ntop;
	echo " Done."
	;;

  *)
	echo "Usage: /etc/init.d/ntop {start|stop|restart|default}"
	exit 1
esac

exit 0
